class Fetchvenuephotos
  @queue = :fetchvenuephotos_queue
  def self.perform(subscription)
    #New York
    venue_ny = ["1195657", "262783", "3002892", "20843", "514330", "56401", "24223", "45767", "2637871", "157648", "107729", "3002869", "2999916", "36714", "369480", "93716", "1495", "3066", "13765", "820295", "1349451", "1161978", "375778", "8885", "82301", "48359", "41415", "308405", "93352", "60729", "22481", "1524333", "71389", "299456", "119764", "21565", "9721", "26447", "1420070", "42733", "200569", "66348", "3002095", "2596499", "19076", "26929", "3350014", "29850", "94774", "30061", "1346256", "18295", "362105", "2082352", "66385", "145967", "1273608", "204075", "796471", "1727398", "1420514", "2403743", "3250791", "2962165", "3386555", "3602873", "3973841", "6321556", "7577260", "3002301", "1519", "677376", "14036", "143112", "8495708", "264047", "1359397", "30699", "1206", "97445", "819205", "5333053", "105450", "6593370", "22313", "3238828", "11196466", "2598644", "2443593", "13458442", "3041723", "26875", "241945", "48688", "125042", "12935", "17215", "2113451", "350520", "13844", "3001706", "1296762", "126201", "14891200", "15707253", "54373", "15780161", "815202", "13372", "11381696"]
    #SF
    venue_sf = ["1572", "1168186", "155", "4447", "896", "879", "4354", "37039", "34998", "346876", "187324", "1749791", "3000292", "1498", "1484", "147692", "87148", "450867", "1056", "1362", "195889", "4589", "1203543", "1647", "2084436", "910270", "17242922"]
    #LA
    venue_la = ["41999", "3000453", "457739", "16430532", "2260615", "100768", "2342272", "1730261", "264271", "48085", "70014", "1870957", "91138", "306614"]
    #London
    venue_ln = ["2575876", "103703", "163636", "674144", "518190", "1281748", "23320", "840843", "1241986", "38990", "152132", "316899", "117482", "48051", "399001", "70178", "124147", "11556008", "23325", "15649406"]
    #Paris
    venue_pa = ["6470", "1695801", "290297", "325719", "183169", "1835542", "239486", "843265", "403893", "437315", "2268969", "39456", "29052", "1174427", "495617", "6489", "432780", "566284", "117806", "14883813", "17375661", "24410674"]
    
    venue_ids = venue_ny + venue_sf + venue_la + venue_ln + venue_pa

    venue_ids.each do |venue_id|
      begin
        access_token = $redis.smembers("accesstokens")[rand($redis.smembers("accesstokens").size)]
        client = Instagram.client(:access_token => access_token)
        response = client.location_recent_media(venue_id)
        response.data.each do |media|
          unless media.location.id.nil?
            unless Photo.exists?(conditions: {ig_media_id: media.id})
              Photo.new.find_location_and_save(media,nil)
            end
          end
        end
      rescue
      end
    end
  end
end